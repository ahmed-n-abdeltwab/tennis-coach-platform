# Render Infrastructure as Code (IaC) Configuration
# Documentation: https://render.com/docs/blueprint-spec

services:
  - type: web
    name: tennis-coach-api
    runtime: node
    region: oregon
    plan: starter
    buildCommand: pnpm install && pnpm db:generate && pnpm build:api
    startCommand: pnpm db:migrate:prod && node dist/apps/api/main.js
    healthCheckPath: /api/health
    envVars:
      # Node.js environment
      - key: NODE_ENV
        value: production
      - key: NODE_VERSION
        value: 20

      # Database connection (auto-linked from Render PostgreSQL)
      - key: DATABASE_URL
        fromDatabase:
          name: tennis-coach-db
          property: connectionString

      # JWT secrets (auto-generated by Render)
      - key: JWT_SECRET
        generateValue: true
      - key: JWT_REFRESH_SECRET
        generateValue: true

      # Frontend URL for CORS (set manually after Cloudflare deployment)
      - key: FRONTEND_URL
        sync: false

      # PayPal integration (set manually)
      - key: PAYPAL_CLIENT_ID
        sync: false
      - key: PAYPAL_CLIENT_SECRET
        sync: false

      # Google Calendar integration (set manually)
      - key: GOOGLE_CLIENT_ID
        sync: false
      - key: GOOGLE_CLIENT_SECRET
        sync: false
      - key: GOOGLE_REDIRECT_URI
        sync: false

      # Email service configuration (set manually)
      - key: SMTP_SENDER_EMAIL
        sync: false
      - key: SMTP_TOKEN
        sync: false

databases:
  - name: tennis-coach-db
    plan: starter
    databaseName: tennis_coach_prod
    user: tennis_coach_user
    region: oregon
