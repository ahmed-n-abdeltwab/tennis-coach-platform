@startuml
package "Frontend (React/Vite)" {
  [Booking UI]
  [Profile Page]
  [Chat Component]
  [Admin Dashboard]
}

package "Backend (NestJS/TypeScript)" {
  [IAM Module] <<Authentication/Authorization>>
  [Accounts Module] <<Unified User/Coach>>
  [BookingTypes Module]
  [Sessions Module]
  [TimeSlots Module]
  [Payments Module]
  [Discounts Module]
  [Messages Module]
  [Calendar Module]
  [Notifications Module]
  [Health Module]
  [Prisma Module] <<Database Access>>
  [Redis Module] <<Caching>>
  [Logger Module]
}

database "PostgreSQL" {
  [accounts] <<Unified Table>>
  [booking_types]
  [sessions]
  [time_slots]
  [discounts]
  [messages]
  [refresh_tokens]
}

cloud "External Services" {
  [PayPal Gateway]
  [Google Calendar API]
  [SMTP Service]
}

cache "Redis" {
  [Session Cache]
  [Rate Limiting]
}

' Frontend to Backend connections
[Booking UI] --> [BookingTypes Module]
[Booking UI] --> [Sessions Module]
[Booking UI] --> [TimeSlots Module]
[Profile Page] --> [Accounts Module]
[Admin Dashboard] --> [Accounts Module]
[Admin Dashboard] --> [Sessions Module]
[Chat Component] --> [Messages Module]

' Authentication flow
[IAM Module] <--> [accounts]
[IAM Module] <--> [refresh_tokens]

' Module to Database connections
[Accounts Module] <--> [accounts]
[BookingTypes Module] <--> [booking_types]
[Sessions Module] <--> [sessions]
[TimeSlots Module] <--> [time_slots]
[Discounts Module] <--> [discounts]
[Messages Module] <--> [messages]

' External service connections
[Payments Module] --> [PayPal Gateway]
[Calendar Module] --> [Google Calendar API]
[Notifications Module] --> [SMTP Service]

' Redis connections
[Redis Module] <--> [Session Cache]
[Redis Module] <--> [Rate Limiting]

' Internal module dependencies
[Sessions Module] --> [Payments Module]
[Sessions Module] --> [Calendar Module]
[Sessions Module] --> [Notifications Module]

note right of [accounts]
  Single unified table for all user types.
  Role field (USER, ADMIN, COACH)
  determines capabilities and permissions.
end note

note bottom of [IAM Module]
  Handles JWT authentication,
  refresh tokens, and role-based
  authorization guards.
end note
@enduml
